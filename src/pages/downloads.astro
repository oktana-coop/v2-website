---
import Layout from '../layouts/Layout.astro';
import MainContainer from '../components/MainContainer.astro';
import NavigationBar from '../components/navigation/NavigationBar.astro';
import Footer from '../components/Footer.astro';
import { getLatestVersion } from '../lib/github';
import { Icon } from 'astro-icon/components';

const latestVersion = await getLatestVersion();
const baseUrl = `https://github.com/oktana-coop/v2/releases/download/v${latestVersion}`;

const downloads = [
  {
    category: "macOS",
    icon: "fa-apple",
    items: [
      { name: "Universal", file: `v2-${latestVersion}-universal.dmg`, recommended: true },
      { name: "Intel", file: `v2-${latestVersion}.dmg` },
      { name: "Apple Silicon", file: `v2-${latestVersion}-arm64.dmg` }
    ]
  },
  {
    category: "Windows", 
    icon: "fa-windows",
    items: [
      { name: "Installer", file: `v2.Setup.${latestVersion}.exe` }
    ]
  },
  {
    category: "Linux",
    icon: "fa-linux", 
    items: [
      { name: "AppImage", file: `v2-${latestVersion}.AppImage`, recommended: true },
      { name: "AppImage (ARM64)", file: `v2-${latestVersion}-arm64.AppImage` },
      { name: "Deb", file: `v2_${latestVersion}_amd64.deb` },
      { name: "Deb (ARM64)", file: `v2_${latestVersion}_arm64.deb` },
      { name: "RPM", file: `v2-${latestVersion}.x86_64.rpm` },
      { name: "RPM (ARM64)", file: `v2-${latestVersion}.aarch64.rpm` }
    ]
  }
];
---

<Layout title="Download V2 - All Platforms and Formats">
  <MainContainer>
    <NavigationBar />
    <div class="max-w-4xl mx-auto p-6">
      
      <div class="text-center mb-8">
        <h1 class="text-3xl font-semibold mb-2">Download V2</h1>
        <p class="text-gray-500 text-sm">v{latestVersion}</p>
      </div>

      <div class="space-y-8">
        {downloads.map(platform => (
          <div class="border-b border-gray-100 pb-6 last:border-b-0">
            <h2 class="text-lg font-semibold mb-4 flex items-center gap-3">
              <Icon name={platform.icon} class="w-5 h-5 text-gray-600" />
              {platform.category}
            </h2>
            <div class="space-y-1">
              {platform.items.map(item => (
                <div class="flex items-center gap-3 py-1.5 px-3 hover:bg-purple-50 rounded-md transition-colors">
                  <a 
                    href={`${baseUrl}/${item.file}`} 
                    class="text-purple-500 hover:text-purple-600 font-medium transition-colors"
                  >
                    {item.name}
                  </a>
                  {item.recommended && (
                    <span class="text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded-full font-medium">
                      Recommended
                    </span>
                  )}
                </div>
              ))}
            </div>
          </div>
        ))}
      </div>

      <div class="text-center mt-8 pt-6 border-t border-gray-100">
        <p class="text-sm text-gray-500">View all releases on <a href="https://github.com/oktana-coop/v2/releases" target="_blank" class="text-purple-500 hover:text-purple-600 font-medium">GitHub</a></p>
      </div>
    </div>
    
    <Footer />
  </MainContainer>
</Layout>