---
import { Image } from 'astro:assets';
import { type ImageMetadata } from 'astro';

import v2Logo from '../../assets/images/v2-logo-light.svg';
import SectionHeading from '../../components/typography/SectionHeading.astro';
import { textClasses } from '../../components/typography/textStyles.ts';

const VERSIONING = 'versioning' as const;
const COLLABORATION = 'collaboration' as const;
const INTEROPERABILITY = 'interoperability' as const;
const PRIVACY_AND_OWNERSHIP = 'privacyAndOwnership' as const;

type ComparisonDimensionCategory = {
  key: string;
  name: string;
  dimensions: ComparisonDimension[];
};

type ComparisonDimension = {
  key: string;
  name: string;
};

const versioning: ComparisonDimensionCategory = {
  key: VERSIONING,
  name: 'Versioning',
  dimensions: [
    { key: 'saveVersionHistory' as const, name: 'Save Version History' },
    {
      key: 'goBackToPreviousVersions' as const,
      name: 'Go Back to Previous Versions',
    },
    { key: 'compareVersions' as const, name: 'Compare Versions' },
    {
      key: 'createAlternateVersions' as const,
      name: 'Create Alternate Versions',
    },
  ],
};

const collaboration: ComparisonDimensionCategory = {
  key: COLLABORATION,
  name: 'Collaboration',
  dimensions: [
    { key: 'asyncCollaboration' as const, name: 'Asynchronous Collaboration' },
    { key: 'realTimeCollaboration' as const, name: 'Real-Time Collaboration' },
  ],
};

const interoperability: ComparisonDimensionCategory = {
  key: INTEROPERABILITY,
  name: 'Interoperability',
  dimensions: [
    { key: 'portableFiles' as const, name: 'Portable Files' },
    { key: 'exportToOtherFormats' as const, name: 'Export to Other Formats' },
  ],
};

const privacyAndOwnership: ComparisonDimensionCategory = {
  key: PRIVACY_AND_OWNERSHIP,
  name: 'Privacy & Ownership',
  dimensions: [
    { key: 'whoOwnsTheFiles' as const, name: 'Who Owns the Files' },
    { key: 'cloudSyncPrivacy' as const, name: 'Cloud Sync Privacy' },
    { key: 'worksOffline' as const, name: 'Works Offline' },
  ],
};

const comparisonDimensionCategories: ComparisonDimensionCategory[] = [
  versioning,
  collaboration,
  interoperability,
  privacyAndOwnership,
];

type VersioningCapabilities = {
  saveVersionHistory: string;
  goBackToPreviousVersions: string;
  compareVersions: string;
  createAlternateVersions: string;
};

type CollaborationCapabilities = {
  asyncCollaboration: string;
  realTimeCollaboration: string;
};

type InteroperabilityCapabilities = {
  portableFiles: string;
  exportToOtherFormats: string;
};

type PrivacyAndOwnershipCapabilities = {
  whoOwnsTheFiles: string;
  cloudSyncPrivacy: string;
  worksOffline: string;
};

type ProductCapabilities = {
  name: string;
  logo?: ImageMetadata;
  [VERSIONING]: VersioningCapabilities;
  [COLLABORATION]: CollaborationCapabilities;
  [INTEROPERABILITY]: InteroperabilityCapabilities;
  [PRIVACY_AND_OWNERSHIP]: PrivacyAndOwnershipCapabilities;
};

const plaintextMarkdown: ProductCapabilities = {
  name: 'Plaintext Markdown Editors',
  versioning: {
    saveVersionHistory: 'External tooling needed (e.g. Git)',
    goBackToPreviousVersions: 'External tooling needed (e.g. Git)',
    compareVersions: 'Git only; plaintext diff',
    createAlternateVersions: 'External tooling needed (e.g. Git)',
  },
  collaboration: {
    asyncCollaboration: 'Git/GitHub setup required',
    realTimeCollaboration: '‚úñÔ∏è',
  },
  interoperability: {
    portableFiles: '‚úîÔ∏è Markdown',
    exportToOtherFormats: 'Limited: DOCX, PDF',
  },
  privacyAndOwnership: {
    whoOwnsTheFiles: 'üîí You',
    cloudSyncPrivacy: '‚òÅÔ∏è Vendor-controlled, not private',
    worksOffline: '‚úîÔ∏è Fully offline',
  },
};

const v2: ProductCapabilities = {
  name: 'v2',
  logo: v2Logo,
  versioning: {
    saveVersionHistory: '‚úîÔ∏è Built-in',
    goBackToPreviousVersions: '‚úîÔ∏è Built-in',
    compareVersions: '‚úîÔ∏è Formatting-aware diffing',
    createAlternateVersions: '‚úîÔ∏è Built-in',
  },
  collaboration: {
    asyncCollaboration:
      '‚ö° Coming Soon: Sophisticated review workflows (GitHub-like)',
    realTimeCollaboration: '‚ö° Coming Soon: optional, on-demand, no servers',
  },
  interoperability: {
    portableFiles: '‚úîÔ∏è Markdown + Git folder',
    exportToOtherFormats: '‚úîÔ∏è Pandoc: DOCX, HTML, Markdown, LaTeX, more',
  },
  privacyAndOwnership: {
    whoOwnsTheFiles: 'üîí You',
    cloudSyncPrivacy: '‚ö° Coming Soon: üîí Encrypted sync',
    worksOffline: '‚úîÔ∏è Fully offline',
  },
};

const cloudBasedEditors: ProductCapabilities = {
  name: 'Cloud-Based Editors',
  versioning: {
    saveVersionHistory: '‚úîÔ∏è',
    goBackToPreviousVersions: '‚úîÔ∏è',
    compareVersions: 'Limited',
    createAlternateVersions: '‚úñÔ∏è',
  },
  collaboration: {
    asyncCollaboration: 'Limited: comments + shared drives',
    realTimeCollaboration: '‚òÅÔ∏è Always-on; distracting, constant presence',
  },
  interoperability: {
    portableFiles: '‚úñÔ∏è Proprietary, vendor lock-in',
    exportToOtherFormats: 'Limited: DOCX, PDF',
  },
  privacyAndOwnership: {
    whoOwnsTheFiles: '‚òÅÔ∏è Stored & processed on vendor servers',
    cloudSyncPrivacy: '‚òÅÔ∏è Vendor-controlled, not private',
    worksOffline: 'Limited: often unreliable',
  },
};

const traditionalWordProcessors: ProductCapabilities = {
  name: 'Traditional Word Processors',
  versioning: {
    saveVersionHistory: '‚úîÔ∏è',
    goBackToPreviousVersions: '‚úîÔ∏è',
    compareVersions: 'Limited: Track Changes',
    createAlternateVersions: '‚úñÔ∏è',
  },
  collaboration: {
    asyncCollaboration: 'Limited: comments + email',
    realTimeCollaboration: 'Requires pairing with cloud services',
  },
  interoperability: {
    portableFiles: 'DOCX-centric, semantic loss',
    exportToOtherFormats: 'Limited: DOCX, PDF',
  },
  privacyAndOwnership: {
    whoOwnsTheFiles: 'üîí You',
    cloudSyncPrivacy: '‚òÅÔ∏è Vendor-controlled, not private',
    worksOffline: '‚úîÔ∏è Fully offline',
  },
};

const comparisonOptions: ProductCapabilities[] = [
  plaintextMarkdown,
  v2,
  cloudBasedEditors,
  traditionalWordProcessors,
];
---

<div class="flex flex-col gap-10">
  <div class="flex flex-col items-center gap-4">
    <SectionHeading text="How is v2 Different" classes="text-center" />
    <p class={`text-center max-w-xl ${textClasses}`}>
      v2 gives you the collaboration capabilities of cloud-based editors (<i
        >and more</i
      >) without sacrificing data ownership
    </p>
  </div>

  <!-- Only display at screens wider than 1360px -->
  <div class="isolate hidden min-[1360px]:block">
    <div class="relative -mx-8">
      <div class="absolute inset-x-4 inset-y-0 -z-10 flex">
        <div
          style="margin-left: 40%"
          aria-hidden="true"
          class="flex w-1/5 px-4"
        >
          <div
            class="w-full rounded-t-xl border-x border-t border-gray-900/10 bg-gray-400/5"
          >
          </div>
        </div>
      </div>
      <table class="w-full table-fixed border-collapse text-left">
        <caption class="sr-only">
          Rich-text editing software feature comparison table
        </caption>
        <colgroup>
          <col class="w-1/5" />
          <col class="w-1/5" />
          <col class="w-1/5" />
          <col class="w-1/5" />
          <col class="w-1/5" />
        </colgroup>
        <thead>
          <tr>
            <td></td>
            {
              comparisonOptions.map((option) => (
                <th scope="col" class="px-6 pt-6 xl:px-8 xl:pt-8">
                  <div class="text-sm/7 text-center font-semibold text-gray-900">
                    {option.logo ? (
                      <Image
                        src={v2Logo}
                        alt={option.name}
                        height="40"
                        class="h-[40px] inline"
                      />
                    ) : (
                      option.name
                    )}
                  </div>
                </th>
              ))
            }
          </tr>
        </thead>
        <tbody>
          {
            comparisonDimensionCategories.map(
              ({ key: categoryKey, name: categoryName, dimensions }) => (
                <Fragment>
                  <tr class="border-b border-gray-900/5">
                    <th
                      scope="colgroup"
                      colspan="4"
                      class="pb-4 pt-8 text-sm/6 font-semibold text-gray-900"
                    >
                      {categoryName}
                    </th>
                  </tr>
                  {dimensions.map(
                    ({ key: dimensionKey, name: dimensionName }) => (
                      <tr class="border-b border-gray-900/5">
                        <th
                          scope="row"
                          class="py-4 text-sm/6 font-normal text-gray-900"
                        >
                          {dimensionName}
                        </th>
                        {comparisonOptions.map((option) => (
                          <td class="px-6 py-4 xl:px-8">
                            <div class="flex items-center justify-center gap-2">
                              <div class="text-center text-sm/6 text-gray-500">
                                {
                                  // @ts-ignore
                                  // TODO: type category and dimension keys properly
                                  option[categoryKey][dimensionKey]
                                }
                              </div>
                            </div>
                          </td>
                        ))}
                      </tr>
                    )
                  )}
                </Fragment>
              )
            )
          }
        </tbody>
      </table>
    </div>
  </div>
</div>
